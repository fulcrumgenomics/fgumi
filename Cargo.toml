[package]
name = "fgumi"
version = "0.1.0"
authors = ["Nils Homer <nils@fulcrumgenomics.com>"]
description = "High-performance tools for UMI-tagged sequencing data: extraction, grouping, and consensus calling"
repository = "https://github.com/fulcrumgenomics/fgumi"
homepage = "https://github.com/fulcrumgenomics/fgumi"
documentation = "https://docs.rs/fgumi"
readme = "README.md"
categories = ["command-line-utilities", "science"]
keywords = ["bioinformatics", "umi", "consensus", "sequencing", "ngs"]
license = "MIT"
edition = "2024"
rust-version = "1.87.0"
resolver = "2"

[dependencies]
clap = { version = "4", features = ["derive", "string"] }
log = "0"
thiserror = "2"
noodles = { version = "0.104.0", features = ["bam", "fasta", "sam", "bgzf", "core", "vcf"] }
noodles-bgzf = { version = "0.45.0", features = ["libdeflate"] }
noodles-util = { version = "0.73.0", features = ["alignment"] }
mimalloc = { version = "0.1.48", default-features = false }
libmimalloc-sys = { version = "0.1.44", features = ["extended"], optional = true }
env_logger = "0.11.8"
enum_dispatch = "0.3.13"
anyhow = "1.0.100"
read-structure = "0.2.0"
seq_io = "0.3.4"
bstr = "1.12.1"
bytes = "1"
fgoxide = "0.6.0"
tempfile = "3.3.0"
lru = "0.16.3"
scoped_threadpool = "0.1.9"
crc32fast = "1.4"
crossbeam-channel = "0.5"
crossbeam-queue = "0.3"
crossbeam-utils = "0.8.21"
parking_lot = "0.12"
libdeflater = "1.25"
isal-rs = { path = "vendor/isal-rs", optional = true }
serde = { version = "1.0.228", features = ["derive"] }
itertools = "0.14.0"
indexmap = "2"
rand = "0.9"
csv = "1.1"
memchr = "2"
murmur3 = "0.5"
statrs = "0.18"
bytesize = "2.3"
sysinfo = { version = "0.38", default-features = false, features = ["system"], optional = true }
rayon = "1.10"
approx = "0.5.1"
ahash = "0.8"
bytemuck = { version = "1.14", features = ["derive"] }
noodles-csi = "0.53.0"
bgzf = "0.3.0"
wide = "1.1"
rand_distr = "0.5"
flate2 = "1.1"
dhat = { version = "0.3", optional = true }

[features]
default = []
dhat-heap = ["dep:dhat"]
# Enable comprehensive memory debugging infrastructure (monitor thread, hot-path atomics, CLI args)
memory-debug = ["dep:libmimalloc-sys", "dep:sysinfo"]
# Enable compare subcommand with bams and metrics (developer tools)
compare = []
# Enable simulate commands for generating synthetic test data
simulate = []
# Enable profiling output for adjacency UMI assigner
profile-adjacency = []
# Use ISA-L/igzip for BGZF compression instead of libdeflate
isal = ["dep:isal-rs"]

[dev-dependencies]
rstest = "0"
proptest = "1.10"
criterion = { version = "0.8", features = ["html_reports"] }

[[bench]]
name = "core_functions"
harness = false

[build-dependencies]
built = { version = "0", features = ["git2"] }

[profile.release]
#lto = true
lto = "fat"
codegen-units = 1

[profile.profiling]
inherits = "release"
debug = "line-tables-only"

# Config for 'cargo dist'
[workspace.metadata.dist]
cargo-dist-version = "0.4.3"
ci = ["github"]
installers = ["shell", "powershell"]
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
    
]
# Necessary to be able to modify the release workflow
allow-dirty = ["ci"]


# The profile that 'cargo dist' will build with
[profile.dist]
inherits = "release"
lto = "thin"

[lib]
name = "fgumi_lib"
path = "src/lib/mod.rs"
